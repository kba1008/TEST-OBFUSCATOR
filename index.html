<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pencetak Sijil Pukal</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3367d6">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .card-title {
            color: #3367d6;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3367d6;
            font-size: 1.5em;
        }

        .upload-section {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .upload-box {
            flex: 1;
            min-width: 250px;
            padding: 20px;
            border: 3px dashed #3367d6;
            border-radius: 10px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-box:hover {
            background: #eef1ff;
            transform: scale(1.02);
        }

        .upload-box i {
            font-size: 3em;
            color: #3367d6;
            margin-bottom: 10px;
        }

        .upload-box p {
            color: #666;
            font-size: 1.1em;
        }

        .upload-box input[type="file"] {
            display: none;
        }

        #templatePreviewContainer {
            margin-top: 20px;
            text-align: center;
        }

        #templatePreview {
            max-width: 100%;
            max-height: 400px;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 10px;
            background: white;
            position: relative;
        }

        #certificateTemplate {
            max-width: 100%;
            max-height: 350px;
            display: none;
        }

        #headersContainer {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            min-height: 60px;
        }

        .draggable-header {
            padding: 12px 20px;
            background: linear-gradient(135deg, #3367d6 0%, #2c5282 100%);
            color: white;
            border-radius: 8px;
            cursor: move;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .draggable-header:hover {
            transform: translateY(-2px);
        }

        .drop-zone {
            position: absolute;
            min-width: 150px;
            min-height: 40px;
            background: rgba(255, 255, 0, 0.3);
            border: 2px dashed #ff6b6b;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-weight: bold;
            cursor: move;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .drop-zone:hover {
            background: rgba(255, 255, 0, 0.5);
        }

        .drop-zone .remove-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #previewSection {
            margin-top: 30px;
        }

        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        .certificate-preview {
            width: 800px;
            height: 600px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            position: relative;
            border: 2px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            page-break-after: always;
        }

        .preview-field {
            position: absolute;
            font-size: 28px;
            font-weight: bold;
            color: #000;
            text-align: center;
            min-width: 200px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 5px;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        button i {
            font-size: 1.2em;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3367d6 0%, #2c5282 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(51, 103, 214, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .hidden {
            display: none;
        }

        .status-message {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: bold;
        }

        .status-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 5px solid #10b981;
        }

        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 5px solid #ef4444;
        }

        .status-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 5px solid #3367d6;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .card, header, .upload-section, .btn-group {
                display: none;
            }
            
            .preview-container {
                display: block;
            }
            
            .certificate-preview {
                width: 100% !important;
                height: auto !important;
                page-break-after: always;
                border: none;
                box-shadow: none;
            }
            
            .preview-field {
                background: transparent !important;
            }
        }

        @media (max-width: 768px) {
            .upload-section {
                flex-direction: column;
            }
            
            .certificate-preview {
                width: 100%;
                height: auto;
                aspect-ratio: 4/3;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üñ®Ô∏è Pencetak Sijil Pukal</h1>
            <p class="subtitle">Muat naik template sijil & senarai peserta untuk cetak pukal</p>
        </header>

        <div class="card">
            <h2 class="card-title">üìÅ 1. Muat Naik Template Sijil</h2>
            <div class="upload-section">
                <div class="upload-box" id="templateDropZone">
                    <div>üñºÔ∏è</div>
                    <p>Klik atau Drag Template Sijil</p>
                    <p><small>(Format: JPG, PNG, PDF)</small></p>
                    <input type="file" id="templateUpload" accept="image/*,.pdf">
                </div>
            </div>
            <div id="templatePreviewContainer" class="hidden">
                <h3>üì∏ Preview Template:</h3>
                <div id="templatePreview">
                    <img id="certificateTemplate" alt="Template Sijil">
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">üìä 2. Muat Naik Senarai Peserta (Excel)</h2>
            <div class="upload-section">
                <div class="upload-box" id="excelDropZone">
                    <div>üìã</div>
                    <p>Klik atau Drag Fail Excel</p>
                    <p><small>(Format: XLSX, XLS, CSV)</small></p>
                    <input type="file" id="excelUpload" accept=".xlsx,.xls,.csv">
                </div>
            </div>
            
            <div id="excelStatus" class="hidden"></div>
            
            <div id="mappingSection" class="hidden">
                <h3>üéØ 3. Letakkan Field pada Template</h3>
                <p style="margin: 10px 0; color: #666;">
                    <strong>Drag & Drop</strong> header dari bawah ke atas template untuk tentukan kedudukan. <br>
                    <small>(Anda boleh mengubah kedudukan field setelah diletakkan)</small>
                </p>
                
                <div id="headersContainer"></div>
                
                <div style="margin-top: 20px;">
                    <button class="btn-warning" id="resetMappingBtn">
                        üîÑ Reset Semua Kedudukan
                    </button>
                </div>
            </div>
        </div>

        <div class="card hidden" id="previewCard">
            <h2 class="card-title">üëÄ 4. Preview & Cetak</h2>
            <div class="btn-group">
                <button class="btn-primary" id="generateBtn">üé® Jana Preview Sijil</button>
                <button class="btn-success" id="printBtn">üñ®Ô∏è Cetak Semua Sijil</button>
                <button class="btn-secondary" id="downloadPdfBtn">üì• Download Semua (PDF)</button>
                <button class="btn-danger" id="clearAllBtn">üóëÔ∏è Kosongkan Semua</button>
            </div>
            
            <div id="previewSection">
                <div class="preview-container" id="previewContainer"></div>
            </div>
        </div>
    </div>

    <!-- SheetJS Library untuk baca Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- jsPDF untuk export PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let templateDataURL = null;
        let excelData = null;
        let headers = [];
        let dropZones = [];
        let certificatesGenerated = false;

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            registerServiceWorker();
        });

        function setupEventListeners() {
            // Template upload
            document.getElementById('templateUpload').addEventListener('change', handleTemplateUpload);
            document.getElementById('templateDropZone').addEventListener('click', () => document.getElementById('templateUpload').click());
            
            // Excel upload
            document.getElementById('excelUpload').addEventListener('change', handleExcelUpload);
            document.getElementById('excelDropZone').addEventListener('click', () => document.getElementById('excelUpload').click());
            
            // Generate certificates
            document.getElementById('generateBtn').addEventListener('click', generateCertificates);
            
            // Print
            document.getElementById('printBtn').addEventListener('click', printCertificates);
            
            // Download PDF
            document.getElementById('downloadPdfBtn').addEventListener('click', downloadAsPDF);
            
            // Clear all
            document.getElementById('clearAllBtn').addEventListener('click', clearAll);
            
            // Reset mapping
            document.getElementById('resetMappingBtn').addEventListener('click', resetMapping);
            
            // Drag and drop for template
            setupDragDrop('templateDropZone', handleTemplateUpload);
            setupDragDrop('excelDropZone', handleExcelUpload);
        }

        // ============================================
        // TEMPLATE HANDLING
        // ============================================
        function handleTemplateUpload(event) {
            const file = event.target.files?.[0] || event.dataTransfer?.files?.[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                templateDataURL = e.target.result;
                document.getElementById('certificateTemplate').src = templateDataURL;
                document.getElementById('certificateTemplate').style.display = 'block';
                document.getElementById('templatePreviewContainer').classList.remove('hidden');
                
                showStatus('Template berjaya dimuat naik!', 'success');
                
                // Reset drop zones if template changes
                resetMapping();
            };
            reader.readAsDataURL(file);
        }

        // ============================================
        // EXCEL HANDLING
        // ============================================
        function handleExcelUpload(event) {
            const file = event.target.files?.[0] || event.dataTransfer?.files?.[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                    
                    if (jsonData.length === 0) {
                        showStatus('Fail Excel kosong!', 'error');
                        return;
                    }
                    
                    headers = jsonData[0]; // First row is headers
                    excelData = jsonData.slice(1); // Rest is data
                    
                    document.getElementById('excelStatus').innerHTML = `
                        <div class="status-success">
                            ‚úÖ Berjaya muat naik: ${excelData.length} rekod dengan ${headers.length} medan
                        </div>
                    `;
                    document.getElementById('excelStatus').classList.remove('hidden');
                    
                    displayHeadersForMapping();
                    document.getElementById('mappingSection').classList.remove('hidden');
                    
                    showStatus(`Berjaya baca ${excelData.length} rekod dari Excel!`, 'success');
                    
                } catch (error) {
                    console.error('Error reading Excel:', error);
                    showStatus('Ralat membaca fail Excel: ' + error.message, 'error');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function displayHeadersForMapping() {
            const container = document.getElementById('headersContainer');
            container.innerHTML = '';
            
            headers.forEach((header, index) => {
                const headerElement = document.createElement('div');
                headerElement.className = 'draggable-header';
                headerElement.draggable = true;
                headerElement.dataset.headerIndex = index;
                headerElement.textContent = header;
                
                // Drag start
                headerElement.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', index);
                    e.dataTransfer.effectAllowed = 'move';
                });
                
                container.appendChild(headerElement);
            });
            
            // Setup drop zones on template preview
            const templatePreview = document.getElementById('templatePreview');
            templatePreview.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            });
            
            templatePreview.addEventListener('drop', function(e) {
                e.preventDefault();
                
                const headerIndex = e.dataTransfer.getData('text/plain');
                if (headerIndex === '') return;
                
                // Calculate position relative to template preview
                const rect = templatePreview.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                createDropZone(parseInt(headerIndex), x, y);
            });
        }

        // ============================================
        // DROP ZONE HANDLING
        // ============================================
        function createDropZone(headerIndex, x, y) {
            const templatePreview = document.getElementById('templatePreview');
            const templateImg = document.getElementById('certificateTemplate');
            
            // Create drop zone
            const dropZone = document.createElement('div');
            dropZone.className = 'drop-zone';
            dropZone.dataset.headerIndex = headerIndex;
            dropZone.style.left = (x - 75) + 'px'; // Center the drop zone
            dropZone.style.top = (y - 20) + 'px';
            dropZone.textContent = headers[headerIndex];
            
            // Make it draggable
            dropZone.addEventListener('mousedown', function(e) {
                if (e.target === dropZone || e.target.className === 'remove-btn') return;
                
                const offsetX = e.clientX - dropZone.getBoundingClientRect().left;
                const offsetY = e.clientY - dropZone.getBoundingClientRect().top;
                
                function onMouseMove(e) {
                    const rect = templatePreview.getBoundingClientRect();
                    let newX = e.clientX - rect.left - offsetX;
                    let newY = e.clientY - rect.top - offsetY;
                    
                    // Keep within bounds
                    newX = Math.max(0, Math.min(newX, rect.width - dropZone.offsetWidth));
                    newY = Math.max(0, Math.min(newY, rect.height - dropZone.offsetHeight));
                    
                    dropZone.style.left = newX + 'px';
                    dropZone.style.top = newY + 'px';
                }
                
                function onMouseUp() {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                }
                
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            });
            
            // Remove button
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-btn';
            removeBtn.innerHTML = '√ó';
            removeBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                dropZone.remove();
            });
            dropZone.appendChild(removeBtn);
            
            templatePreview.appendChild(dropZone);
            dropZones.push(dropZone);
        }

        function resetMapping() {
            const templatePreview = document.getElementById('templatePreview');
            const dropZones = templatePreview.querySelectorAll('.drop-zone');
            dropZones.forEach(zone => zone.remove());
            showStatus('Semua kedudukan telah direset', 'info');
        }

        // ============================================
        // CERTIFICATE GENERATION
        // ============================================
        function generateCertificates() {
            if (!templateDataURL) {
                showStatus('Sila muat naik template sijil dahulu!', 'error');
                return;
            }
            
            if (!excelData || excelData.length === 0) {
                showStatus('Sila muat naik fail Excel dahulu!', 'error');
                return;
            }
            
            const templatePreview = document.getElementById('templatePreview');
            const dropZones = templatePreview.querySelectorAll('.drop-zone');
            
            if (dropZones.length === 0) {
                showStatus('Sila letakkan field pada template dahulu!', 'error');
                return;
            }
            
            const previewContainer = document.getElementById('previewContainer');
            previewContainer.innerHTML = '';
            
            // Get positions of all drop zones
            const fieldPositions = Array.from(dropZones).map(zone => {
                const rect = zone.getBoundingClientRect();
                const previewRect = templatePreview.getBoundingClientRect();
                
                return {
                    headerIndex: parseInt(zone.dataset.headerIndex),
                    x: rect.left - previewRect.left,
                    y: rect.top - previewRect.top,
                    width: rect.width,
                    text: zone.textContent.trim().replace('√ó', '').trim()
                };
            });
            
            // Generate certificate for each row
            excelData.forEach((row, rowIndex) => {
                const certificate = document.createElement('div');
                certificate.className = 'certificate-preview';
                certificate.style.backgroundImage = `url(${templateDataURL})`;
                
                // Add all fields
                fieldPositions.forEach(pos => {
                    const field = document.createElement('div');
                    field.className = 'preview-field';
                    field.style.left = pos.x + 'px';
                    field.style.top = pos.y + 'px';
                    field.style.width = pos.width + 'px';
                    field.textContent = row[pos.headerIndex] || '';
                    
                    certificate.appendChild(field);
                });
                
                previewContainer.appendChild(certificate);
            });
            
            document.getElementById('previewCard').classList.remove('hidden');
            certificatesGenerated = true;
            
            showStatus(`Berjaya jana ${excelData.length} sijil!`, 'success');
        }

        // ============================================
        // PRINT & EXPORT
        // ============================================
        function printCertificates() {
            if (!certificatesGenerated) {
                showStatus('Sila jana preview sijil dahulu!', 'error');
                return;
            }
            
            window.print();
        }

        async function downloadAsPDF() {
            if (!certificatesGenerated) {
                showStatus('Sila jana preview sijil dahulu!', 'error');
                return;
            }
            
            showStatus('‚è≥ Sedang menjana PDF...', 'info');
            
            // UI Delay allow status to show
            await new Promise(resolve => setTimeout(resolve, 100));

            try {
                const { jsPDF } = window.jspdf;
                const templateImg = document.getElementById('certificateTemplate');
                const dropZones = document.querySelectorAll('.drop-zone');
                
                // 1. Get original image dimensions
                const imgWidth = templateImg.naturalWidth;
                const imgHeight = templateImg.naturalHeight;
                const orientation = imgWidth > imgHeight ? 'l' : 'p';
                
                // 2. Calculate Scale (Preview vs Original)
                const previewRect = document.getElementById('templatePreview').getBoundingClientRect();
                const scaleX = imgWidth / previewRect.width;
                const scaleY = imgHeight / previewRect.height;
                
                const doc = new jsPDF({ 
                    orientation: orientation,
                    unit: 'px',
                    format: [imgWidth, imgHeight]
                });

                // 3. Map Fields with Scaled Coordinates
                const fields = Array.from(dropZones).map(zone => {
                    const rect = zone.getBoundingClientRect();
                    const relX = rect.left - previewRect.left;
                    const relY = rect.top - previewRect.top;
                    return {
                        headerIndex: parseInt(zone.dataset.headerIndex),
                        x: relX * scaleX,
                        y: relY * scaleY,
                        // Scale the font size roughly based on screen-to-image ratio (28px base)
                        fontSize: 28 * scaleX
                    };
                });

                // 4. Generate Pages
                excelData.forEach((row, i) => {
                    if (i > 0) doc.addPage([imgWidth, imgHeight], orientation);
                    
                    doc.addImage(templateDataURL, 'JPEG', 0, 0, imgWidth, imgHeight);
                    
                    fields.forEach(field => {
                        const text = String(row[field.headerIndex] || '');
                        doc.setFontSize(field.fontSize);
                        doc.setTextColor(0, 0, 0);
                        doc.setFont("helvetica", "bold");
                        // Add small padding offset to match UI look
                        doc.text(text, field.x + (10 * scaleX), field.y + field.fontSize);
                    });
                });

                doc.save('Sijil-Pukal.pdf');
                showStatus('‚úÖ PDF berjaya dimuat turun!', 'success');
                
            } catch (err) {
                console.error(err);
                showStatus('Ralat menjana PDF: ' + err.message, 'error');
            }
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function clearAll() {
            // Reset all inputs
            document.getElementById('templateUpload').value = '';
            document.getElementById('excelUpload').value = '';
            
            // Clear displays
            document.getElementById('certificateTemplate').src = '';
            document.getElementById('certificateTemplate').style.display = 'none';
            document.getElementById('templatePreviewContainer').classList.add('hidden');
            document.getElementById('excelStatus').classList.add('hidden');
            document.getElementById('excelStatus').innerHTML = '';
            document.getElementById('mappingSection').classList.add('hidden');
            document.getElementById('headersContainer').innerHTML = '';
            document.getElementById('previewContainer').innerHTML = '';
            document.getElementById('previewCard').classList.add('hidden');
            
            // Reset variables
            templateDataURL = null;
            excelData = null;
            headers = [];
            dropZones = [];
            certificatesGenerated = false;
            
            // Remove all drop zones
            resetMapping();
            
            showStatus('Semua telah dikosongkan!', 'info');
        }

        function showStatus(message, type) {
            // Create or update status message
            let statusDiv = document.getElementById('globalStatus');
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'globalStatus';
                statusDiv.style.position = 'fixed';
                statusDiv.style.top = '20px';
                statusDiv.style.right = '20px';
                statusDiv.style.zIndex = '1000';
                document.body.appendChild(statusDiv);
            }
            
            statusDiv.className = `status-message status-${type}`;
            statusDiv.textContent = message;
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function setupDragDrop(elementId, callback) {
            const element = document.getElementById(elementId);
            
            element.addEventListener('dragover', function(e) {
                e.preventDefault();
                element.style.borderColor = '#10b981';
                element.style.backgroundColor = '#f0fdf4';
            });
            
            element.addEventListener('dragleave', function() {
                element.style.borderColor = '#3367d6';
                element.style.backgroundColor = '';
            });
            
            element.addEventListener('drop', function(e) {
                e.preventDefault();
                element.style.borderColor = '#3367d6';
                element.style.backgroundColor = '';
                
                if (e.dataTransfer.files.length > 0) {
                    const event = { dataTransfer: e.dataTransfer };
                    callback(event);
                }
            });
        }

        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            }
        }
    </script>
</body>
</html>
